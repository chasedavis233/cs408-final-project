<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BiteRec â€¢ Profile</title>
  <link rel="icon" href="logo.svg" type="image/svg+xml" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fraunces:opsz,wght@9..144,600;9..144,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* page-scoped styles only */
    .profile-page .profile-head{display:flex;align-items:center;gap:14px;margin-bottom:12px}
    .profile-page .avatar{
      width:64px;height:64px;border-radius:16px;display:flex;align-items:center;justify-content:center;
      font-weight:800;letter-spacing:.3px;color:#0b0f13;background:#fff;border:1px solid var(--chrome)
    }
    .profile-page .grid-2{display:grid;gap:18px;grid-template-columns:2fr 1.2fr}
    .profile-page .card h3{margin:.2rem 0 .6rem}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .form{display:grid;gap:10px}
    .field{display:grid;gap:6px}
    .field label{font-weight:700}
    .field input[type="text"], .field input[type="email"]{
      background:rgba(255,255,255,.06); color:var(--text);
      border:1px solid var(--chrome); border-radius:12px; padding:.7rem .8rem
    }
    .switch{display:inline-flex;gap:10px;align-items:center}
    .switch input{width:42px;height:24px; accent-color:var(--brand)}
    .stat-cards{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
    .stat-card{padding:14px;border-radius:16px;border:1px solid var(--chrome);background:rgba(255,255,255,.04)}
    .stat-card .num{font-size:28px;font-weight:900;color:var(--brand)}
    .muter{color:var(--muted)}
    .danger{border-color:#ff6b6b;color:#ffb3b3}
  </style>
</head>
<body data-theme="obsidian" class="profile-page">
  <!-- NAV (identical to index; orange icon/labels handled by style.css rules you kept) -->
  <header class="site-header">
    <div class="nav-shell glass-nav">
      <nav class="nav container" aria-label="Primary">
        <a class="brand" href="index.html" aria-label="BiteRec home">
          <img class="brand-mark" src="logo.svg" alt="BiteRec logo" width="22" height="22" />
          <span class="brand-word">BiteRec</span>
        </a>
        <ul class="navlinks">
          <li><a class="navlink" data-nav="explore" href="explore.html">
            <svg class="nav-ico" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M11 4a7 7 0 1 1-4.95 2.05A6.97 6.97 0 0 1 11 4m0-2a9 9 0 1 0 5.657 15.9l3.72 3.72 1.415-1.414-3.72-3.72A9 9 0 0 0 11 2Z"/></svg>
            <span>Explore</span></a></li>
          <li><a class="navlink" data-nav="lists" href="lists.html">
            <svg class="nav-ico" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M7 5h14v2H7V5Zm0 6h14v2H7v-2Zm0 6h14v2H7v-2ZM3 5h2v2H3V5Zm0 6h2v2H3v-2Zm0 6h2v2H3v-2Z"/></svg>
            <span>My Lists</span></a></li>
          <li><a class="navlink navlink-icon" data-nav="profile" href="profile.html" aria-label="Profile">
            <svg class="nav-ico" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
          </a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container" id="main" tabindex="-1">
    <div class="page-frame">
      <section class="profile">
        <div class="profile-head">
          <div class="avatar" id="avatarBox">JD</div>
          <div>
            <h1 class="display" id="greeting">Your Profile</h1>
            <p class="muter">Manage your account and app preferences.</p>
          </div>
        </div>

        <div class="grid-2">
          <!-- LEFT: account & preferences -->
          <article class="card">
            <h3>Account</h3>
            <div class="form">
              <div class="row">
                <button class="btn btn--primary" id="btnSignIn">Sign In</button>
                <button class="btn btn--ghost brand-outline" id="btnSignOut">Sign Out</button>
                <span class="muter" id="authState">Not signed in</span>
              </div>

              <div class="field">
                <label for="displayName">Display name</label>
                <input id="displayName" type="text" placeholder="Your name" />
              </div>

              <div class="field">
                <label for="avatarText">Avatar initials</label>
                <input id="avatarText" type="text" maxlength="3" placeholder="e.g., JD" />
              </div>

              <div class="field">
                <label for="defaultZip">Default ZIP code</label>
                <input id="defaultZip" type="text" inputmode="numeric" placeholder="e.g., 83702" />
              </div>

              <div class="row">
                <div class="switch">
                  <input id="priceTracking" type="checkbox">
                  <label for="priceTracking"><strong>Enable price tracking</strong></label>
                </div>
              </div>

              <div class="row">
                <div class="switch">
                  <input id="notifyEmail" type="checkbox">
                  <label for="notifyEmail">Email notifications (deals, reminders)</label>
                </div>
              </div>

              <div class="row">
                <div class="switch">
                  <input id="shareRecs" type="checkbox">
                  <label for="shareRecs">Allow sharing my recommendations</label>
                </div>
              </div>

              <div class="row" style="margin-top:6px">
                <button class="btn btn--primary" id="btnSave">Save Settings</button>
              </div>
            </div>
          </article>

          <!-- RIGHT: quick stats & data tools -->
          <aside class="card">
            <h3>Quick Stats</h3>
            <div class="stat-cards" id="stats">
              <div class="stat-card">
                <div class="muter">Saved</div>
                <div class="num" id="statSaved">0</div>
              </div>
              <div class="stat-card">
                <div class="muter">Tried</div>
                <div class="num" id="statTried">0</div>
              </div>
              <div class="stat-card">
                <div class="muter">Favorites</div>
                <div class="num" id="statFavs">0</div>
              </div>
            </div>

            <h3 style="margin-top:14px">Data</h3>
            <div class="row">
              <button class="btn btn--ghost brand-outline" id="btnExport">Export JSON</button>
              <label class="btn btn--ghost brand-outline" for="importFile" style="cursor:pointer">Import JSON</label>
              <input id="importFile" type="file" accept="application/json" hidden />
            </div>
            <div class="row" style="margin-top:8px">
              <button class="btn btn--ghost brand-outline danger" id="btnErase">Erase Local Data</button>
            </div>
            <p class="muter" style="margin-top:8px">AWS will replace local storage once wired (Cognito + API Gateway + DynamoDB).</p>
          </aside>
        </div>
      </section>
    </div>
  </main>

  <script type="module">
    import { Store } from './js/main.js'; // uses your existing Store helpers

    const KEY = 'biterec-demo';

    // Elements
    const displayName = document.getElementById('displayName');
    const avatarText = document.getElementById('avatarText');
    const avatarBox  = document.getElementById('avatarBox');
    const defaultZip = document.getElementById('defaultZip');
    const priceTracking = document.getElementById('priceTracking');
    const notifyEmail = document.getElementById('notifyEmail');
    const shareRecs = document.getElementById('shareRecs');
    const greeting = document.getElementById('greeting');
    const authState = document.getElementById('authState');

    const statSaved = document.getElementById('statSaved');
    const statTried = document.getElementById('statTried');
    const statFavs  = document.getElementById('statFavs');

    // Seed profile fields inside the same local object
    function loadModel() {
      const data = Store.load(); // {settings, places}
      // Attach a simple profile envelope if missing
      if (!data.profile) {
        data.profile = {
          name: 'Guest',
          avatar: 'JD',
          zip: '83702',
          notifyEmail: false,
          shareRecs: false,
          auth: { signedIn: false, email: '' }
        };
        Store.save(data);
      }
      return data;
    }

    let model = loadModel();

    function paint() {
      const { profile, settings, places } = model;

      displayName.value = profile.name || '';
      avatarText.value = profile.avatar || '';
      avatarBox.textContent = (profile.avatar || 'JD').toUpperCase();
      defaultZip.value = profile.zip || '';

      priceTracking.checked = !!settings?.priceEnabled;
      notifyEmail.checked = !!profile.notifyEmail;
      shareRecs.checked = !!profile.shareRecs;

      greeting.textContent = profile.name ? `${profile.name}'s Profile` : 'Your Profile';
      authState.textContent = profile.auth?.signedIn ? `Signed in${profile.auth.email ? ' as ' + profile.auth.email : ''}` : 'Not signed in';

      // Stats (Saved = all places, Tried = status 'tried', Favorites = hearted placeholder)
      const saved = (places || []).length;
      const tried = (places || []).filter(p => p.status === 'tried').length;
      const favs  = JSON.parse(localStorage.getItem('biterec-favs') || '[]').length;

      statSaved.textContent = saved;
      statTried.textContent = tried;
      statFavs.textContent  = favs;
    }

    // Save Settings
    document.getElementById('btnSave').addEventListener('click', () => {
      model.profile.name = displayName.value.trim() || 'Guest';
      model.profile.avatar = (avatarText.value.trim() || 'JD').toUpperCase();
      model.profile.zip = defaultZip.value.trim() || '83702';
      model.profile.notifyEmail = !!notifyEmail.checked;
      model.profile.shareRecs = !!shareRecs.checked;

      model.settings.priceEnabled = !!priceTracking.checked;

      Store.save(model);
      paint();
    });

    // Avatar live update
    avatarText.addEventListener('input', () => {
      avatarBox.textContent = (avatarText.value || 'JD').toUpperCase();
    });

    // Export
    document.getElementById('btnExport').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(model, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'biterec-export.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    // Import
    document.getElementById('importFile').addEventListener('change', async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      try {
        const text = await file.text();
        const imported = JSON.parse(text);
        localStorage.setItem(KEY, JSON.stringify(imported));
        model = loadModel();
        paint();
        alert('Import complete.');
      } catch {
        alert('Import failed. Invalid JSON.');
      } finally {
        e.target.value = '';
      }
    });

    // Erase Local
    document.getElementById('btnErase').addEventListener('click', () => {
      if (!confirm('Erase all local BiteRec data? This cannot be undone.')) return;
      localStorage.removeItem(KEY);
      localStorage.removeItem('biterec-favs');
      model = loadModel();
      paint();
      alert('Local data erased.');
    });

    // Mock auth buttons (swap to Cognito later)
    document.getElementById('btnSignIn').addEventListener('click', () => {
      model.profile.auth = { signedIn: true, email: 'you@example.com' };
      Store.save(model); paint();
    });
    document.getElementById('btnSignOut').addEventListener('click', () => {
      model.profile.auth = { signedIn: false, email: '' };
      Store.save(model); paint();
    });

    // Init
    paint();
  </script>
</body>
</html>
